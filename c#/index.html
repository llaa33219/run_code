<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>C# 코드 실행기 및 인코더</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    #container {
      padding: 20px;
      box-sizing: border-box;
      width: 100%;
      height: 100%;
    }
    textarea {
      width: 100%;
      height: 80%;
      font-family: Consolas, "Courier New", monospace;
      font-size: 14px;
      padding: 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: none;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }
    pre {
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: Consolas, "Courier New", monospace;
    }
    h2 {
      font-size: 18px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
<div id="container"></div>
<script>
(function() {
    // Base64 인코딩/디코딩 (UTF-8 지원) 함수들
    function encodeBase64(str) {
        const encoder = new TextEncoder();
        const bytes = encoder.encode(str);
        let binary = '';
        for (let i = 0; i < bytes.length; i++) {
            binary += String.fromCharCode(bytes[i]);
        }
        return btoa(binary);
    }
    
    function decodeBase64(str) {
        const binary = atob(str);
        const bytes = new Uint8Array(binary.length);
        for (let i = 0; i < binary.length; i++) {
            bytes[i] = binary.charCodeAt(i);
        }
        const decoder = new TextDecoder();
        return decoder.decode(bytes);
    }
    
    const container = document.getElementById('container');
    const query = window.location.search;
    
    // URL에 base64 인코딩된 코드가 "?=" 뒤에 붙어있다면 디코딩 후 실행
    if(query.startsWith('?=')) {
        const base64Code = query.substring(2);
        let decodedCode;
        try {
            decodedCode = decodeBase64(base64Code);
        } catch(e) {
            decodedCode = 'Base64 디코딩 오류: ' + e.message;
        }
        
        // 실행할 코드를 보여줄 영역 생성
        const codeTitle = document.createElement('h2');
        codeTitle.textContent = "실행할 C# 코드:";
        container.appendChild(codeTitle);
        
        const codePre = document.createElement('pre');
        codePre.textContent = decodedCode;
        container.appendChild(codePre);
        
        // 실행 결과를 보여줄 영역 생성
        const outputTitle = document.createElement('h2');
        outputTitle.textContent = "실행 결과:";
        outputTitle.style.marginTop = "20px";
        container.appendChild(outputTitle);
        
        const outputPre = document.createElement('pre');
        outputPre.textContent = "실행 중...";
        container.appendChild(outputPre);
        
        // rextester API를 통해 C# 코드 실행 (링크는 원본 그대로 사용)
        fetch("https://rextester.com/rundotnet/api", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                LanguageChoice: 1, // C# (Mono)
                Program: decodedCode,
                Input: ""
            })
        })
        .then(response => response.json())
        .then(data => {
            let result = "";
            if(data.Errors) {
                result += "에러:\n" + data.Errors;
            }
            if(data.Result) {
                result += "\n출력:\n" + data.Result;
            }
            if(result.trim() === "") {
                result = "실행 결과가 없습니다.";
            }
            outputPre.textContent = result;
        })
        .catch(error => {
            outputPre.textContent = "실행 중 오류 발생: " + error;
        });
    } else {
        // URL에 코드가 없는 경우, 코드 입력창과 실행 버튼 제공
        const textarea = document.createElement('textarea');
        textarea.placeholder = '여기에 C# 코드를 입력하세요.';
        container.appendChild(textarea);
        
        const button = document.createElement('button');
        button.textContent = '실행';
        container.appendChild(button);
        
        button.addEventListener('click', function() {
            const code = textarea.value;
            const encoded = encodeBase64(code);
            // 현재 URL의 origin과 pathname을 유지하며 ?= 뒤에 base64 인코딩된 코드를 추가
            window.location.href = window.location.origin + window.location.pathname + '?=' + encoded;
        });
    }
})();
</script>
</body>
</html>
